<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Voir mes notes</title>
<style>
h2{
  color: seagreen;
  text-align:center;
}
input{
  color:black;
  height:26px;
  width:300px;
}
button{
  color:white;
  background: seagreen;
  border:none;
  padding:6px 12px;
  border-radius:6px;
  cursor:pointer;
}
button:hover{
  background: green;
}
.btn-container{
  text-align:center;
  margin-top:10px;
}
ul{
  max-width:400px;
  margin:20px auto;
  padding-left:20px;
  text-align:left;
}
li{
  margin-bottom:8px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
li span{
  cursor: pointer;
}
</style>
</head>
<body>

<h2>Entre ton pseudo pour voir tes notes</h2>
<p>
  <input type="text" id="pseudo" placeholder="Ton pseudo"/>
</p>
<div class="btn-container">
  <button id="seeMessagesBtn">Voir mes notes</button>
</div>
<div id="Mesnotes"></div>

<ul id="liste-taches"></ul>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
import { getDatabase, ref, onValue, update, remove } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

// 🔑 Config Firebase
const firebaseConfig = {
  apiKey: "AIzaSyAGw2i_FjlugIURw2_ZVTEzkD4RwTI90wM",
  authDomain: "mon-bloc-note.firebaseapp.com",
  databaseURL: "https://mon-bloc-note-default-rtdb.firebaseio.com",
  projectId: "mon-bloc-note",
  storageBucket: "mon-bloc-note.firebasestorage.app",
  messagingSenderId: "761151647915",
  appId: "1:761151647915:web:0a9af0d52677509646c7ee"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const liste = document.getElementById("liste-taches");
const pseudo = localStorage.getItem("pseudo");

if(!pseudo){
  alert("Choisis d'abord un pseudo !");
  window.location.href = "index.html";
}

const tachesRef = ref(db, "taches/" + pseudo);

// Lire les tâches et afficher
onValue(tachesRef, (snapshot)=>{
  liste.innerHTML = ""; 
  snapshot.forEach((child)=>{
    const tache = child.val();
    const li = document.createElement("li");

    // Texte de la tâche
    const texteSpan = document.createElement("span");
    texteSpan.textContent = tache.texte;
    texteSpan.style.textDecoration = tache.fait ? "line-through" : "none";
    texteSpan.style.color = tache.fait ? "gray" : "black";

    // Cliquer sur le texte pour barrer
    texteSpan.addEventListener("click", ()=>{
      if(!tache.fait){
        update(ref(db, "taches/" + pseudo + "/" + child.key), { fait: true });
      }
    });

    // Bouton croix pour supprimer
    const supprBtn = document.createElement("button");
    supprBtn.textContent = "❌";
    supprBtn.addEventListener("click", ()=>{
      remove(ref(db, "taches/" + pseudo + "/" + child.key));
    });

    li.appendChild(texteSpan);
    li.appendChild(supprBtn);
    liste.appendChild(li);
  });
});
</script>
</body>
</html>
